<!DOCTYPE html>
<html lang="en">
  <!--
    Hey, isn't this the best intended source you've ever seen?
    And it's HTML5 - so it must be awesome.
  -->
  <head>
    <meta charset="utf-8">
    <meta content="Easily insert translations for Rails I18n projects on the fly: just type “t” and hit tab." name="description">
    <meta content="2009-03-05" name="date">
    <title>Rails I18n: translation on the fly with TextMate (plug-in)</title>
    <link href="../apple-touch-icon.png" rel="apple-touch-icon">
    <link href="../hagenburger.rss" rel="alternate" type="application/rss+xml">
    <link href="../stylesheets/hagenburger.css?4" rel="stylesheet">
    <script src="../javascripts/hagenburger.js"></script>
  </head>
  <body>
    <div id="nico-hagenburger">
      <header>
        <a href="/" id="logo"><img alt="Nico Hagenburger — Ruby on Rails, Haml, Sass, HTML5" src="../images/nico-hagenburger-ruby-on-rails.png"></a>
        <nav><a href="/">Home</a><a href="../BLOG.html">Blog</a><a href="../CONTACT.html">Contact</a><a href="../PORTFOLIO.html">Portfolio</a></nav>
        <div><strong>Hi, I’m Nico Hagenburger</strong><br>My pleasure is designing<br>clean, simple websites<br>and developing web applications in Ruby on Rails.</div>
      </header>
      <div id="content">
        <article class="post" data-slug="rails-i18n-translation-on-the-fly-with-textmate-plug-in">
          <h1>Rails I18n: translation on the fly with TextMate (plug-in)</h1>
          <p><em>I made a short presentation for this plug-in at the <a href="http://www.rug-b.com">Ruby User Group Berlin</a> today.</em></p>
          <p>Before Ruby on Rails 2.2 it hasn’t been funny translating Rails applications with gettext and all the others. <strong>rake updatepo</strong>, <strong>rake makemo</strong> again and again. Now the translated strings are stored in the <strong>I18n YAML files</strong>:</p>
          <pre><code><b>de:</b>&#x000A;  <b>users:</b>&#x000A;  <b>update:</b>&#x000A;  <b>notice:</b> &quot;Du hast dein Geschlecht erfolgreich geändert.&quot;&#x000A;</code></pre>
          <p>OK, cool. But what sucks is writing <code>t(&#39;users.update.notice&#39;)</code> in every place and add them to the YAML files by hand. There’s something like <strong>updatepo</strong> but it didn’t work for my (looks up only in the controllers, doesn’t work with <strong>&lt;%- -%&gt;</strong> in views, …).</p>
          <p>So I wrote my own little <strong>TextMate plug-in</strong>. You can just call it by typing “t” and pressing tab (tab trigger). You’ll be asked by for the ID and the translations for each language in the next step. The languages are detected if the language files have been created before. In the example can see a German (de) and English (en) translated project. Press “fn” and return to close the box if you don’t want to use the mouse:</p>
          <figure><img src='textmate-i18n-translation-for-ruby-on-rails.png' alt='Enter i18n translations with this Ruby on Rails TextMate plug-in'><figcaption>Enter i18n translations with this Ruby on Rails TextMate plug-in</figcaption></figure>
          <p>It inserts the t or I18n::translate function depending on if you are in a controller, view or elsewhere. If you want, you can customize the code for the suggested ID. For me it was useful to automatically make a suggestion if a <strong>flash[:notice]</strong> appears in the current line.</p>
          <h2 id="installation">Installation:</h2>
          <ol><li><p>Install ya2yaml gem (because of UTF-8 problems).</p>    sudo gem install ya2yaml</li><li><p>Save the ruby script on your Mac.</p></li><li><p>Go to TextMate’s bundle editor. Choose “Ruby on Rails” in the list and add a new command (“+” button at the bottom).</p>_Commands:_    RUBYLIB="$TM_BUNDLE_SUPPORT/lib:$RUBYLIB"
              "${TM_RUBY:=ruby}" -- "/Users/yourdir/h_quick_translation.rb"<p>_Input:_ Selected Text
          \*Or:\* Nothing
          \*Output:\* Insert as Text
          \*Activation:\* Tab Trigger + “t”</p></li></ol><figure><img src='textmate-ruby-on-rails-i18n-plugin.png' alt='TextMate’s bundle editor: Configuration for the i18n Ruby on Rails plugin'><figcaption>TextMate’s bundle editor: Configuration for the i18n Ruby on Rails plugin</figcaption></figure>
          <h2 id="heres-the-plugin">Here’s the plug-in:</h2>
          <pre><code><i><i>#!/usr/bin/env ruby</i>&#x000A;&#x000A;<i><i># Copyright:</i>&#x000A;<i><i>#   (c) 2009 Nico Hagenburger, Hagenburger GmbH</i>&#x000A;<i><i>#   Released under the MIT license.</i>&#x000A;<i><i>#   Visit my Blog at http://www.hagenburger.net</i>&#x000A;<i><i>#   Follow me on http://twitter.com/Hagenburger</i>&#x000A;<i><i># Author: Nico Hagenburger (follow me on twitter for contact)</i>&#x000A;<i><i># Description:</i>&#x000A;<i><i>#   Inserts an translation string to the current position</i>&#x000A;<i><i>#   and to the localization file(s).</i>&#x000A;<i><i># Example for German/DE and English/EN translation:</i>&#x000A;<i><i>#   users.update.success</i>&#x000A;<i><i>#   Du hast dein Geschlecht erfolgreich geändert.</i>&#x000A;<i><i>#   You changed your gender successfully.</i>&#x000A;<i><i># Hint: </i>&#x000A;<i><i>#   Press fn + return to close window instead of clicking OK</i>&#x000A;<i><i>#   (if fn key is available).</i>&#x000A;&#x000A;<em>require</em> <q>'rails_bundle_tools'</q>&#x000A;<em>require</em> <q>'yaml'</q>&#x000A;<em>require</em> <q>'rubygems'</q>&#x000A;<em>require</em> <q>'ya2yaml'</q>&#x000A;<em>require</em> <q>'jcode'</q>&#x000A;$<b>KCODE</b> = <q>'u'</q>&#x000A;&#x000A;current_file = <b>RailsPath</b>.<em>new</em>&#x000A;rails_root = <b>RailsPath</b>.<em>new</em>.rails_root&#x000A;locales_dir = <b>File</b>.join(rails_root, <q>'config'</q>, <q>'locales'</q>)&#x000A;&#x000A;<em>if</em> [:view, :helper, :controller].include?(current_file.file_type)&#x000A;  method = <q>'t'</q>&#x000A;<em>else</em>&#x000A;  method = <q>'<b>I18n</b>.t'</q>&#x000A;<em>end</em>&#x000A;&#x000A;<i><i># Change this, if you want to use outher default keys.</i>&#x000A;<i><i># Default is “controller.action.key”</i>&#x000A;suggestion = <q>''</q>&#x000A;<em>unless</em> current_file.controller_name.nil?&#x000A;  suggestion &lt;&lt; <q>&quot;<code>#{current_file.controller_name}</code>.&quot;</q>&#x000A;<em>end</em>&#x000A;<em>unless</em> current_file.action_name.nil?&#x000A;  suggestion &lt;&lt; <q>&quot;<code>#{current_file.action_name}</code>.&quot;</q>&#x000A;<em>end</em>&#x000A;<em>case</em> <b>TextMate</b>.current_line&#x000A;<em>when</em> /flash\[:([a-z_]+)\]/&#x000A;  suggestion &lt;&lt; <q>&quot;<code>#{$~[1]}</code>n&quot;</q>&#x000A;<em>when</em> /&lt;h1/&#x000A;  suggestion &lt;&lt; <q>&quot;headlinen&quot;</q>&#x000A;<em>when</em> /link_to/&#x000A;  suggestion &lt;&lt; <q>&quot;link_&quot;</q>&#x000A;<em>end</em>&#x000A;&#x000A;languages = []&#x000A;<b>Dir</b>.open(locales_dir).entries.each <em>do</em> |file|&#x000A;  <em>if</em> file =~ /^translation_([a-zA-<b>Z_</b>-]+).yml$/&#x000A;    languages &lt;&lt; $~[1]&#x000A;  <em>end</em>&#x000A;<em>end</em>&#x000A;&#x000A;<i><i># Don’t use TextMate.textbox. You won’t get any results.</i>&#x000A;user_input = <b>TextMate</b>.cocoa_dialog(&#x000A;    <q>'textbox'</q>,&#x000A;    :informative_text =&gt; <q>&quot;<b>Enter</b> <b>ID</b> <em>in</em> the first line <em>and</em> translations &quot;</q> +&#x000A;      <q>&quot;<em>in</em> the following lines <em>in</em> this order:nn&quot;</q> +&#x000A;      <q>&quot;<b>ID</b>&quot;</q> + languages.map { |l| <q>&quot;n<code>#{l}</code> (optional)&quot;</q> }.join(<q>''</q>),&#x000A;    :text =&gt; suggestion,&#x000A;    :title =&gt; <q>&quot;<b>Add</b> translation (by www.hagenburger.net)&quot;</q>,&#x000A;    :focus_textbox =&gt; true,&#x000A;    :editable =&gt; true,&#x000A;    :button1 =&gt; <q>'<b>OK</b>'</q>,&#x000A;    :button2 =&gt; <q>'<b>Cancel</b>'</q>&#x000A;  )&#x000A;&#x000A;<em>if</em> user_input[0] == <q>&quot;1&quot;</q> <i><i># OK was clicked</i>&#x000A;  id            = user_input[1]&#x000A;  id_splitted   = id.split(<q>'.'</q>)&#x000A;  translations  = user_input[2..-1]&#x000A;&#x000A;  0.upto(languages.length - 1) <em>do</em> |i|&#x000A;    filename = <b>File</b>.join(locales_dir, <q>&quot;translation_<code>#{languages[i]}</code>.yml&quot;</q>)&#x000A;    yaml = <b>YAML</b>.load(<b>File</b>.read(filename))&#x000A;    yaml[languages[i]] ||= {}&#x000A;    current = yaml[languages[i]]&#x000A;    id_splitted[0..-2].each <em>do</em> |key|&#x000A;      current[key] = {} <em>unless</em> current[key].is_a?(<b>Hash</b>)&#x000A;      current = current[key]&#x000A;    <em>end</em>&#x000A;    current[id_splitted.last] = <q>&quot;<code>#{translations[i]}</code>&quot;</q>&#x000A;    <b>File</b>.open(filename, <q>'w+'</q>) <em>do</em> |file|&#x000A;      <i><i># to_yaml has problems with German umlauts</i>&#x000A;      <i><i># and would print them as binary.</i>&#x000A;      text = yaml.ya2yaml&#x000A;      file.puts text&#x000A;    <em>end</em>&#x000A;  <em>end</em>&#x000A;&#x000A;  print <q>&quot;<code>#{method}</code>('<code>#{id}</code>')&quot;</q>&#x000A;  <b>TextMate</b>.exit_insert_text&#x000A;<em>end</em>&#x000A;</code></pre>
          <p>Have fun and please tell me about your improvements!</p>
        </article>
        <div id="twitter">
          <a href="http://twitter.com/hagenburger">Follow me on twitter: @hagenburger</a>
        </div>
      </div>
    </div>
    <footer>
      <a href="http://github.com/hagenburger" id="github">
        <span>Fork me on GitHub!</span>
        <span>Get free lemonade!</span>
      </a>
      <small>© Nico Hagenburger/Hagenburger GmbH 2000—2010 · Blog posts published under CC share alike licence (except design and artwork or otherwise mentioned)</small>
    </footer>
  </body>
  <!--
    You've just read it till the end.
    If you're that fascinated, you definitaly have to hire me.
  -->
</html>
