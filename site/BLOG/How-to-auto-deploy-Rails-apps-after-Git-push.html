<!DOCTYPE html>
<html lang="en">
  <!--
    Hey, isn't this the best intended source you've ever seen?
    And it's HTML5 - so it must be awesome.
  -->
  <head>
    <meta charset="utf-8">
    <meta content="Ever wondered how Heroku “deploying” Rails apps via Git works? It’s very easy to setup Git." name="description">
    <meta content="git,rails,deploy,heroku,push,auto" name="keywords">
    <meta content="2009-08-30" name="date">
    <title>How to auto deploy Rails apps after Git push ··· Nico Hagenburger</title>
    <link href="../apple-touch-icon.png" rel="apple-touch-icon">
    <link href="../hagenburger.rss" rel="alternate" type="application/rss+xml">
    <link href="../stylesheets/hagenburger.css?4" rel="stylesheet">
    <script src="../javascripts/hagenburger.js"></script>
  </head>
  <body>
    <div id="nico-hagenburger">
      <header>
        <a href="/" id="logo"><img alt="Nico Hagenburger — Git, Rails, Deploy, Heroku, Push, Auto" src="../images/nico-hagenburger-ruby-on-rails.png"></a>
        <nav><a href="/">Home</a><a href="../BLOG.html">Blog</a><a href="../CONTACT.html">Contact</a><a href="../PORTFOLIO.html">Portfolio</a></nav>
        <div><strong>Hi, I’m Nico Hagenburger</strong><br>My pleasure is designing<br>clean, simple websites<br>and developing web applications in Ruby on Rails.</div>
      </header>
      <div id="content">
        <article class="post" data-slug="howto-auto-deploy-rails-apps-after-git-push">
          <h1>How to auto deploy Rails apps after Git push</h1>
          <p>For my most recent project, I had to share a git repository with another Rails developer. He also had to make deploys on my server. As my server has many projects, I though about having another way than giving him access via SSH for cap deploy.</p>
          <p>I remembered <a href="http://www.heroku.com">Heroku</a> automatically deploys Rails apps after commits. So here’s how you can have the same functionality with pure Git.</p>
          <h2 id="configuration-of-ssh-and-users">Configuration of SSH And Users</h2>
          <p>I’m assuming the following configuration:</p>
          <dl>
            <dt>Git repository</dt>
            <dd>/home/git/awesome-rails-app.git</dd>
            <dt>Deploy path</dt>
            <dd>/var/www/awesome-rails-app</dd>
            <dt>Git user</dt>
            <dd>git</dd>
            <dt>Deploy user</dt>
            <dd>deploy</dd>
            <dt>Authentication</dt>
            <dd>with SSH keys</dd>
          </dl>
          <p>First, create a SSH key for the user git (unless you already did so) and add it for for the deploy user and vice versa:</p>
          <pre class="command-line"><code><i># log in as git:</i>&#x000A;<kbd>ssh-keygen -t rsa</kbd>&#x000A;<i># log in as deploy:</i>&#x000A;<kbd>cat /home/git/.ssh/id_rsa.pub &gt;&gt; /home/deploy/authorized_keys</kbd>&#x000A;<kbd>ssh-keygen -t rsa</kbd>&#x000A;<i># log in as git:</i>&#x000A;<kbd>cat /home/deploy/.ssh/id_rsa.pub &gt;&gt; /home/git/authorized_keys</kbd></code></pre>
          <h2 id="installing-the-git-hook">Installing the Git Hook</h2>
          <p>Git offers <a href="http://book.git-scm.com/5_git_hooks.html">some hooks</a>, where you can add your own code. The most interestion hook for having a deploy is “post-receive”. Just add the deploy command:</p>
          <pre><code><i># File: /home/git/awesome-rails-app.git/hooks/post-receive</i>&#x000A;<i>#!/bin/sh</i>&#x000A;&#x000A;cd /var/www/awesome-rails-app/current &amp;&amp; cap deploy:migrations&#x000A;&#x000A;<i>## If Git isn’t on the same server as the application:</i>&#x000A;<i># ssh deploy@deploy-server.com \</i>&#x000A;<i>#   <q>'cd /var/www/awesome-rails-app/current &amp;&amp; cap deploy:migrations'</q></i>&#x000A;<i>## Don’t forget to add the SSH keys.</i>&#x000A;</code></pre>
          <p>Make this file executable:</p>
          <pre class="command-line"><code><kbd>chmod +x /home/git/awesome-rails-app.git/hooks/post-receive</kbd></code></pre>
          <h2 id="finish">Finish</h2>
          <p>Now it should work (on your local mashine):</p>
          <pre class="command-line"><code><kbd>git push origin master</kbd></code></pre>
          <p>You’ll see all commands of the cap deploy:migrations process in your console.</p>
          <p>This post was inspired by <a href="http://blog.elctech.com/2008/12/16/deploy-automatically-after-a-new-git-push-like-heroku/">this post</a>. After you finished the automatical deploy, there is some other interesting homework: auto test before commits, integration your bug tracker, &#8230;</p>
        </article>
        <div id="twitter">
          <a href="http://twitter.com/hagenburger">Follow me on twitter: @hagenburger</a>
        </div>
      </div>
    </div>
    <footer>
      <a href="http://github.com/hagenburger" id="github">
        <span>Fork me on GitHub!</span>
        <span>Get free lemonade!</span>
      </a>
      <small>© Nico Hagenburger/Hagenburger GmbH 2000—2010 · Blog posts published under CC share alike licence (except design and artwork or otherwise mentioned)</small>
    </footer>
  </body>
  <!--
    You've just read it till the end.
    If you're that fascinated, you definitaly have to hire me.
  -->
</html>
